# Voice Cloning Website (PHP + Coqui XTTS)

> ุฑุงูโุงูุฏุงุฒ ฺฉุงูู ูุจโุณุงุช ฺฉูููโุตุฏุง ฺูุฏุฒุจุงููุ ุจุฏูู ูุญุฏูุฏุชุ ูุฎุตูุต ุงุณุชูุงุฏู ุฎุงููุงุฏฺฏ

## ููุฑุณุช ูุทุงูุจ
1. ูุนุฑู ูพุฑูฺู ู ูุนูุงุฑ
2. ูพุดโูุงุฒูุง
3. ูุตุจ ู ุงุฌุฑุง (Docker)
4. ุงุณุชูุงุฏู ุงุฒ ุณุงุช
5. ุงูุฒูุฏู ุฒุจุงู ุง ูุฏู ุฌุฏุฏ
6. ุงููุช ู ุงุณุชูุงุฏู ููุท ุฏุฑ ุดุจฺฉูู ุดุฎุต
7. ูฺฉุงุช ุจูุจูุฏ ฺฉูุช ุตุฏุง
8. ุชูุณุนู ุขูุฏู

---

## 1. ูุนุฑู ูพุฑูฺู ู ูุนูุงุฑ

![diagram](docs/architecture.png)

| ุณุฑูุณ | ูพูุฑุช | ุชูุถุญ |
|-------|-------|---------|
| **web (PHP-Apache)** | 8080 | ุฑุงุจุท ฺฉุงุฑุจุฑุ ุชู ุฏุงุฑฺฉ/ูุงุชุ ุถุจุท ุง ุขูพููุฏ ุตุฏุงุ ุงุฑุณุงู ูุชู |
| **tts (Python-Flask)** | 5000 | ููุชูุฑ TTS ูุฏู XTTS v1 (Coqui) + langdetectุ ฺฉููู ุตุฏุง ู ุฎูุงูุฏู ูุชู |

ูุฑ ุฏู ุณุฑูุณ ุฏุฑ ุดุจฺฉูู ุฏุงุฎู ยซvoicenetยป (Docker) ูุฑุงุฑ ุฏุงุฑูุฏ.

## 2. ูพุดโูุงุฒูุง
- Docker 24.x + docker compose v2
- ุญุฏุงูู ธ GB RAM (GPU ุงุฎุชุงุฑ ูู ุณุฑุนุช ุฑุง โ ูโฺฉูุฏ)
- ุณุณุชูโุนุงูู Linux/macOS/Windows (ุง WSL)

## 3. ูุตุจ ู ุงุฌุฑุง
```bash
# ุฏุฑุงูุช ุณูุฑุณ
$ git clone https://github.com/<YOUR_USER>/voice-clone-php.git
$ cd voice-clone-php

# ุงููู ุงุฌุฑุง (ุฏุงูููุฏ ุงูุฌโูุง ู ูุฏู XTTS ~1.5GB)
$ docker compose up --build
```
ูพุณ ุงุฒ ุขูุงุฏู ุดุฏู ฺฉุงูุชูุฑูุง:
- http://localhost:8080 โ ุฑุงุจุท ูุจ
- http://localhost:5000 โ API ุณุฑูุฑ (ูุณุฑูุง /clone ู /tts)

## 4. ุงุณุชูุงุฏู ุงุฒ ุณุงุช
1. ุฑู ยซ๐ค Recordยป ุจุฒูุฏ ุง ฺฉ ูุงู ุตูุช (ดโถ ุซุงูู ุชูุฒ) ุขูพููุฏ ฺฉูุฏ.
2. ยซClone Voiceยป โ ุณุฑูุฑ ูุงู ุฑุง ุฐุฎุฑู ู ฺฉ ุดูุงุณู ุจุฑูโฺฏุฑุฏุงูุฏ.
3. ูุชู ุฏูุฎูุงู ุฑุง (ูุฑ ุฒุจุงู) ุฏุฑ textarea ุจููุณุฏ.
4. ยซSpeakยป โ ุฎุฑูุฌ wav ุชููุฏ ู ูพุฎุด ูโุดูุฏ.

> XTTS v1 ูุนูุงู ฑณ ุฒุจุงู ุงุตู ุฑุง ุจุง ฺฉูุช ุจุงูุง ูพุดุชุจุงู ูโฺฉูุฏ (en, es, fr, de, it, pt, pl, ru, nl, cz, tr, ar, zh). ุจุฑุง ูุงุฑุณ/ุขุฐุฑ ฺฉูุช ูุชูุณุท ุงุณุช.

## 5. ุงูุฒูุฏู ุฒุจุงู ุง ูุฏู ุฌุฏุฏ
- **ูุฏู ูุงุฑุณ VITS**: ุฏุฑ `tts-backend/app.py` ูุงู ูุฏู ุฑุง ุชุบุฑ ุฏูุฏ:
  ```python
  MODEL_NAME = "tts_models/fa/custom/vits"
  ```
- **ุณูุฆฺ ุฎูุฏฺฉุงุฑ**: ูโุชูุงูุฏ ุฏฺฉุดูุฑ `language -> model_name` ุชุนุฑู ู ุจุฑ ุงุณุงุณ ุฎุฑูุฌ `langdetect` ุงูุชุฎุงุจ ฺฉูุฏ.

### 5.1 ุขููุฒุด ูุฏู ูุงุฑุณ ุงุฎุชุตุงุต (ุงุฎุชุงุฑ)

1. ุฏุงุฏูู ุตูุช ูุงุฑุณ ุฌูุนโุขูุฑ ฺฉูุฏ (ุญุฏุงูู ฑ ุณุงุนุชุ ูุฑฺูุฏุฑ ุจุดุชุฑ ุจูุชุฑ). ููุงุจุน ูพุดููุงุฏ:
   - Mozilla Common Voice (fa)
   - ูุจูุงฺฏโูุง ุตูุช ุง ูพุงุฏฺฉุณุชโูุง ุขุฒุงุฏ
2. ุจุฑุง ูุฑ ุฌูููุ ูุงู wav + ูุชู ุฏุฑุณุช ฺฉูุฏ (`metadata.csv` ุจูโุตูุฑุช `wav|ูุชู`)
3. ฺฉุชุงุจุฎุงููู ๐คTTS ุฏุงุฑุง ุงุณฺฉุฑูพุช fine-tune ุงุณุช:
   ```bash
   pip install TTS==0.22.0
   TTS/bin/train_tts.py --continue_path tts_models/fa/custom/vits \
        --config_path TTS/configs/fine_tune/vits_finetune_fa.json \
        --output_path ./finetuned_fa
   ```
4. ูพุณ ุงุฒ ุงุชูุงูุ ูููุฏุฑ `./finetuned_fa` ุฑุง ุจู `/tts-backend/models/fa_custom` ฺฉูพ ู ุฏุฑ `MODEL_MAP["fa"]` ูุณุฑ ุฌุฏุฏ ุฑุง ูุฑุงุฑ ุฏูุฏ.

### 5.2 ุงุชุตุงู ุจู API ููุด ูุตููุน iGap

ุงฺฏุฑ ุฏุฑ iGap ุญุณุงุจ ุชูุณุนูโุฏููุฏู ุฏุงุฑุฏ ู ฺฉูุฏ API ุฏุฑุงูุช ฺฉุฑุฏูโุงุฏุ ูโุชูุงูุฏ ุงุฒ ููุด ูุตููุน ูุงุฑุณ ุขู ุจูโุนููุงู fallback ุงุณุชูุงุฏู ฺฉูุฏ. ูููููู ุณุงุฏู:

```python
import requests, base64

def igap_tts(text):
    resp = requests.post(
        "https://api.igap.ai/tts",  # ุขุฏุฑุณ ูุฑุถ
        json={"text": text, "lang": "fa"},
        headers={"Authorization": f"Bearer {os.getenv('IGAP_TOKEN')}"}
    )
    resp.raise_for_status()
    audio_b64 = resp.json()["audio"]
    return base64.b64decode(audio_b64)
```

ุฏุฑ `app.py` ูโุชูุงูุฏ ูุจู ุงุฒ `engine = get_engine_for(lang)` ุงู ุดุฑุท ุฑุง ุงุถุงูู ฺฉูุฏ:

```python
if lang == "fa" and os.getenv("IGAP_TOKEN"):
    audio_data = igap_tts(text)
    with open(output_wav, "wb") as f:
        f.write(audio_data)
    return send_file(output_wav, mimetype="audio/wav", ...)
```

> ุชูุฌู: ูุณุฑ ู ูุณุชูุฏุงุช ุฑุณู API iGap ุฑุง ุจุฑุฑุณ ฺฉูุฏุ ุขุฏุฑุณ ุจุงูุง ูุฑุถ ุงุณุช.

## 6. ุงููุช ู ุดุจฺฉููโ ุฎุตูุต
- ุงฺฏุฑ ููุท LAN: ูพูุฑุชโูุง ุฑุง ุฑู ุฑูุชุฑ ูุญุฏูุฏ ฺฉูุฏ.
- ุงุญุฑุงุฒ ููุช ูพุงู ุฏุฑ Apache:
  ```apache
  AuthType Basic
  AuthName "Family Only"
  AuthUserFile /var/www/.htpasswd
  Require valid-user
  ```
- ุงุฌุงุฏ ฺฉุงุฑุจุฑ: `docker compose exec web htpasswd -c /var/www/.htpasswd youruser`

## 7. ูฺฉุงุช ฺฉูุช ุตุฏุง
- ูููููู ูุฑุฌุน ณโถ ุซุงููุ ุจุฏูู ููุฒ ูุญุท.
- ูุชู โค ฒตฐ ฺฉุงุฑุงฺฉุชุฑุ ุงุนุฏุงุฏ ุฑุง ุจู ุญุฑูู ุจููุณุฏ.
- ุจุฑุง ุญุฑูู ุงุฎุชุตุงุฑ (F B I) ุญุฑูู ุฑุง ุจุง ูุงุตูู ุจููุณุฏ.

## 8. ุชูุณุนู ุขูุฏู
- ูพุดุชุจุงู GPU (Nvidia): `docker compose up --build --compatibility --gpus all`
- ุงุณุชุฑู ุฒูุฏู (WebSocket + FastAPI)
- ุฐุฎุฑูู ูพุฑููุงูโูุง ุฏุฑ SQLite + ุฑุงุจุท ูุฏุฑุช

---

<p align="center">ุจุง ุนุดู โค๏ธ ุชูุณุท ุฎุงููุงุฏูู ูุง</p>