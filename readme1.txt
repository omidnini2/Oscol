==============================
راهنمای سریع – آموزش زبان فارسی به سیستم کلون صدا
==============================

۱) افزودن نمونهٔ فارسی
----------------------
• به صفحهٔ «train.php» بروید (لینک در وب‌سایت).
• یک فایل wav تمیز (۳–۶ ثانیه) + متن دقیق همان جمله را وارد کنید.
• دکمهٔ «آپلود نمونه» را بزنید. فایل و متن در مسیر `data/dataset/fa` ذخیره و در `metadata.csv` ثبت می‌شود.

۲) فاین‌تیون مدل
----------------
پس از جمع‌آوری حداقل ~۳۰ دقیقه دادهٔ خوب (هرچه بیشتر بهتر):

```
# داخل کانتینر python-tts یا هر محیط پایتون
pip install TTS==0.22.0
TTS/bin/train_tts.py \
  --continue_path tts_models/fa/custom/vits \
  --config_path TTS/configs/fine_tune/vits_finetune_fa.json \
  --data_path data/dataset/fa \
  --output_path models/fa_finetuned
```

۳) استفاده از مدل فاین‌تیون‌شده
------------------------------
• فولدر خروجی (`models/fa_finetuned`) را به کانتینر کپی کنید.
• در `tts-backend/app.py` مقدار `MODEL_MAP["fa"]` را برابر مسیر جدید قرار دهید.
• کانتینر python-tts را ری‌استارت کنید.

۴) خطاهای خواندن
-----------------
اگر متن فارسی به‌درستی خوانده نمی‌شود:
1. ورودی را کوتاه کنید (≤۲۵۰ کاراکتر).
2. اعراب‌گذاری دقیق بنویسید (برای کلمات مشکل).
3. اعداد را به حروف تبدیل کنید.
4. نمونه‌های بیشتری با همان کلمات اضافه و مجدداً فاین‌تیون کنید.

۵) استفاده از سرویس iGap (اختیاری)
----------------------------------
• متغیر محیطی `IGAP_TOKEN` را در کانتینر python-tts تنظیم کنید.
• کد آماده تماس API در README بخش ۵.۲ توضیح داده شده است.

۶) افزودن خودکار نمونه با تشخیص گفتار
------------------------------
• در صفحهٔ «train.php» دکمهٔ «ضبط صدا» را بزنید و جملهٔ دلخواه را به‌صورت طبیعی بیان کنید.
• سیستم با استفاده از مدل Whisper متن شما را تشخیص داده، نمایش می‌دهد و آمادهٔ ذخیره در دیتاست می‌شود.
• پس از تأیید «آپلود نمونه»، فایل و متن در دیتاست فارسی ذخیره می‌شود.

۷) فاین‌تیون خودکار (سطح پیشرفته)
------------------------------
می‌توانید یک cron job داخل کانتینر python-tts تعریف کنید تا مثلاً هر شب اگر دیتاست ≥۳۰ دقیقه بود، اسکریپت زیر را اجرا کند:

```
#!/bin/bash
if [ $(sox --show-progress data/dataset/fa/*.wav 2>&1 | grep -oP '(?<=Total
time: )\d+') -ge 1800 ]; then
  TTS/bin/train_tts.py \
     --continue_path tts_models/fa/custom/vits \
     --data_path data/dataset/fa \
     --output_path models/fa_autotune && \
  echo "Auto fine-tune complete" >> /var/log/tts_autotune.log
fi
```

بعد از اتمام، مدل جدید توسط `app.py` به‌صورت تنبل بارگذاری می‌شود (در صورت تغییر مسیر `MODEL_MAP["fa"]`).

موفق باشید 🌹